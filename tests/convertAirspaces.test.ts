import { describe, expect, it } from 'vitest';
import { YaixmConverter } from '../src/yaixm-converter.js';

// TODO add more tests

describe('test parsing complete valid airspace definition blocks to GeoJSON', () => {
    it('read single airspace with linked ground service', async () => {
        const inputFilepath = './tests/fixtures/airspace-single-arc-clockwise.yaml';
        const serviceFilePath = './tests/fixtures/service.yaml';
        const expectedGeojson = {
            type: 'FeatureCollection',
            features: [
                {
                    type: 'Feature',
                    properties: {
                        name: 'ABERDEEN CTA',
                        type: 'CTA',
                        class: 'D',
                        upperCeiling: {
                            value: 115,
                            unit: 'FL',
                            referenceDatum: 'STD',
                        },
                        lowerCeiling: {
                            value: 1500,
                            unit: 'FT',
                            referenceDatum: 'MSL',
                        },
                        activatedByNotam: false,
                        activity: 'NONE',
                    },
                    geometry: {
                        type: 'Polygon',
                        coordinates: [
                            [
                                [-1.97639, 57.36472],
                                [-1.976137074865283, 57.36476771122865],
                                [-1.9788341975893549, 57.36876130241012],
                                [-1.981720021483238, 57.37271641735056],
                                [-1.9847927187135597, 57.376630467669294],
                                [-1.9880503372772136, 57.38050089103329],
                                [-1.9914908021422775, 57.384325152860804],
                                [-1.9951119164757585, 57.38810074800862],
                                [-1.9989113629577142, 57.39182520244186],
                                [-2.0028867051812096, 57.39549607488498],
                                [-2.0070353891374975, 57.3991109584531],
                                [-2.0113547447857427, 57.402667482262125],
                                [-2.015841987706531, 57.40616331301665],
                                [-2.020494220838311, 57.40959615657472],
                                [-2.0253084362958793, 57.41296375948784],
                                [-2.030281517269897, 57.41626391051557],
                                [-2.0354102400063896, 57.41949444211333],
                                [-2.0406912758650764, 57.42265323189238],
                                [-2.0461211934553174, 57.42573820405089],
                                [-2.0516964608483876, 57.42874733077511],
                                [-2.057413447864703, 57.43167863360955],
                                [-2.0632684284345646, 57.43453018479503],
                                [-2.0692575830308964, 57.43730010857376],
                                [-2.0753770011723973, 57.439986582460556],
                                [-2.0816226839954375, 57.44258783847881],
                                [-2.0879905468929776, 57.445102164360776],
                                [-2.0944764222187007, 57.44752790471094],
                                [-2.101076062054498, 57.44986346213173],
                                [-2.1077851410393635, 57.45210729831062],
                                [-2.1145992592577008, 57.454257935067886],
                                [-2.1215139451849843, 57.45631395536408],
                                [-2.1285246586886366, 57.4582740042666],
                                [-2.1356267940819462, 57.46013678987449],
                                [-2.142815683228781, 57.461901084200804],
                                [-2.1500865986967925, 57.463565724011886],
                                [-2.1574347569567682, 57.465129611622686],
                                [-2.1648553216257205, 57.46659171564801],
                                [-2.1723434067512644, 57.4679510717083],
                                [-2.1798940801347886, 57.46920678309046],
                                [-2.18750236669087, 57.470358021362024],
                                [-2.1951632518403583, 57.47140402693921],
                                [-2.2028716849345087, 57.47234410960778],
                                [-2.2106225827074995, 57.473177648996554],
                                [-2.2184108327546608, 57.473904095003086],
                                [-2.2262312970336824, 57.474522968171385],
                                [-2.2340788153860704, 57.47503386002101],
                                [-2.241948209076077, 57.47543643332765],
                                [-2.2498342843443218, 57.475730422354815],
                                [-2.2577318359732996, 57.47591563303625],
                                [-2.265635650861959, 57.47599194310945],
                                [-2.273540511606522, 57.4759593021995],
                                [-2.2814412000847133, 57.47581773185384],
                                [-2.2893325010405534, 57.475567325527344],
                                [-2.2972092056668916, 57.47520824851818],
                                [-2.3050661151828202, 57.474740737854226],
                                [-2.3128980444031613, 57.47416510213012],
                                [-2.3206998252971878, 57.47348172129546],
                                [-2.3284663105337766, 57.47269104639364],
                                [-2.336192377010207, 57.471793599252344],
                                [-2.343872929361811, 57.470789972125104],
                                [-2.3515029034497434, 57.469680827284925],
                                [-2.359077269824128, 57.468466896569865],
                                [-2.366591037159891, 57.46714898088114],
                                [-2.374039255662603, 57.46572794963387],
                                [-2.381417020441708, 57.46420474016138],
                                [-2.388719474848524, 57.46258035707303],
                                [-2.3959418137764765, 57.46085587156634],
                                [-2.4030792869210327, 57.45903242069396],
                                [-2.410127201996876, 57.457111206585914],
                                [-2.4170809279098946, 57.45509349562782],
                                [-2.4239358978816106, 57.45298061759583],
                                [-2.4306876125237284, 57.45077396474858],
                                [-2.4373316428605434, 57.4484749908775],
                                [-2.4438636332969894, 57.44608521031542],
                                [-2.4502793045301865, 57.443606196905066],
                                [-2.4565744564023975, 57.44103958292742],
                                [-2.4627449706933624, 57.43838705799161],
                                [-2.468786813850051, 57.4356503678863],
                                [-2.4746960396519473, 57.43283131339433],
                                [-2.4804687918100146, 57.429931749070725],
                                [-2.4861013064976123, 57.426953581985586],
                                [-2.4915899148116507, 57.42389877043253],
                                [-2.4969310451623783, 57.420769322603604],
                                [-2.502121225590254, 57.417567295231976],
                                [-2.5071570860084345, 57.41429479220298],
                                [-2.5120353603694707, 57.410953963134965],
                                [-2.516752888754905, 57.407547001930766],
                                [-2.5213066193865057, 57.404076145300834],
                                [-2.525693610557979, 57.400543671259385],
                                [-2.529911032486054, 57.39695189759436],
                                [-2.533956169079926, 57.39330318031245],
                                [-2.537826419628114, 57.389599912060376],
                                [-2.541519300401861, 57.38584452052348],
                                [-2.5450324461742886, 57.38203946680276],
                                [-2.5483636116545987, 57.378187243771706],
                                [-2.551510672836659, 57.37429037441377],
                                [-2.554471628261437, 57.370351410142],
                                [-2.5572446001927687, 57.36637292910191],
                                [-2.5598278357060598, 57.36235753445855],
                                [-2.562219707689565, 57.358307852669505],
                                [-2.564418715757983, 57.35422653174438],
                                [-2.566423487078162, 57.35011623949252],
                                [-2.56556, 57.35],
                                [-1.96722, 57.35],
                                [-1.97639, 57.36472],
                            ],
                        ],
                    },
                },
            ],
        };

        const converter = new YaixmConverter({ fixGeometries: true, strictSchemaValidation: true });
        await converter.convertFromFile(inputFilepath, { type: 'airspace', serviceFilePath });
        const geojson = converter.toGeojson();

        expect(geojson).toEqual(expectedGeojson);
    });
    it('read single airspace with single clockwise arc definition', async () => {
        const inputFilepath = './tests/fixtures/airspace-single-arc-clockwise.yaml';
        const expectedGeojson = {
            type: 'FeatureCollection',
            features: [
                {
                    type: 'Feature',
                    properties: {
                        name: 'ABERDEEN CTA',
                        type: 'CTA',
                        class: 'D',
                        upperCeiling: {
                            value: 115,
                            unit: 'FL',
                            referenceDatum: 'STD',
                        },
                        lowerCeiling: {
                            value: 1500,
                            unit: 'FT',
                            referenceDatum: 'MSL',
                        },
                        activatedByNotam: false,
                        activity: 'NONE',
                    },
                    geometry: {
                        type: 'Polygon',
                        coordinates: [
                            [
                                [-1.97639, 57.36472],
                                [-1.976137074865283, 57.36476771122865],
                                [-1.9788341975893549, 57.36876130241012],
                                [-1.981720021483238, 57.37271641735056],
                                [-1.9847927187135597, 57.376630467669294],
                                [-1.9880503372772136, 57.38050089103329],
                                [-1.9914908021422775, 57.384325152860804],
                                [-1.9951119164757585, 57.38810074800862],
                                [-1.9989113629577142, 57.39182520244186],
                                [-2.0028867051812096, 57.39549607488498],
                                [-2.0070353891374975, 57.3991109584531],
                                [-2.0113547447857427, 57.402667482262125],
                                [-2.015841987706531, 57.40616331301665],
                                [-2.020494220838311, 57.40959615657472],
                                [-2.0253084362958793, 57.41296375948784],
                                [-2.030281517269897, 57.41626391051557],
                                [-2.0354102400063896, 57.41949444211333],
                                [-2.0406912758650764, 57.42265323189238],
                                [-2.0461211934553174, 57.42573820405089],
                                [-2.0516964608483876, 57.42874733077511],
                                [-2.057413447864703, 57.43167863360955],
                                [-2.0632684284345646, 57.43453018479503],
                                [-2.0692575830308964, 57.43730010857376],
                                [-2.0753770011723973, 57.439986582460556],
                                [-2.0816226839954375, 57.44258783847881],
                                [-2.0879905468929776, 57.445102164360776],
                                [-2.0944764222187007, 57.44752790471094],
                                [-2.101076062054498, 57.44986346213173],
                                [-2.1077851410393635, 57.45210729831062],
                                [-2.1145992592577008, 57.454257935067886],
                                [-2.1215139451849843, 57.45631395536408],
                                [-2.1285246586886366, 57.4582740042666],
                                [-2.1356267940819462, 57.46013678987449],
                                [-2.142815683228781, 57.461901084200804],
                                [-2.1500865986967925, 57.463565724011886],
                                [-2.1574347569567682, 57.465129611622686],
                                [-2.1648553216257205, 57.46659171564801],
                                [-2.1723434067512644, 57.4679510717083],
                                [-2.1798940801347886, 57.46920678309046],
                                [-2.18750236669087, 57.470358021362024],
                                [-2.1951632518403583, 57.47140402693921],
                                [-2.2028716849345087, 57.47234410960778],
                                [-2.2106225827074995, 57.473177648996554],
                                [-2.2184108327546608, 57.473904095003086],
                                [-2.2262312970336824, 57.474522968171385],
                                [-2.2340788153860704, 57.47503386002101],
                                [-2.241948209076077, 57.47543643332765],
                                [-2.2498342843443218, 57.475730422354815],
                                [-2.2577318359732996, 57.47591563303625],
                                [-2.265635650861959, 57.47599194310945],
                                [-2.273540511606522, 57.4759593021995],
                                [-2.2814412000847133, 57.47581773185384],
                                [-2.2893325010405534, 57.475567325527344],
                                [-2.2972092056668916, 57.47520824851818],
                                [-2.3050661151828202, 57.474740737854226],
                                [-2.3128980444031613, 57.47416510213012],
                                [-2.3206998252971878, 57.47348172129546],
                                [-2.3284663105337766, 57.47269104639364],
                                [-2.336192377010207, 57.471793599252344],
                                [-2.343872929361811, 57.470789972125104],
                                [-2.3515029034497434, 57.469680827284925],
                                [-2.359077269824128, 57.468466896569865],
                                [-2.366591037159891, 57.46714898088114],
                                [-2.374039255662603, 57.46572794963387],
                                [-2.381417020441708, 57.46420474016138],
                                [-2.388719474848524, 57.46258035707303],
                                [-2.3959418137764765, 57.46085587156634],
                                [-2.4030792869210327, 57.45903242069396],
                                [-2.410127201996876, 57.457111206585914],
                                [-2.4170809279098946, 57.45509349562782],
                                [-2.4239358978816106, 57.45298061759583],
                                [-2.4306876125237284, 57.45077396474858],
                                [-2.4373316428605434, 57.4484749908775],
                                [-2.4438636332969894, 57.44608521031542],
                                [-2.4502793045301865, 57.443606196905066],
                                [-2.4565744564023975, 57.44103958292742],
                                [-2.4627449706933624, 57.43838705799161],
                                [-2.468786813850051, 57.4356503678863],
                                [-2.4746960396519473, 57.43283131339433],
                                [-2.4804687918100146, 57.429931749070725],
                                [-2.4861013064976123, 57.426953581985586],
                                [-2.4915899148116507, 57.42389877043253],
                                [-2.4969310451623783, 57.420769322603604],
                                [-2.502121225590254, 57.417567295231976],
                                [-2.5071570860084345, 57.41429479220298],
                                [-2.5120353603694707, 57.410953963134965],
                                [-2.516752888754905, 57.407547001930766],
                                [-2.5213066193865057, 57.404076145300834],
                                [-2.525693610557979, 57.400543671259385],
                                [-2.529911032486054, 57.39695189759436],
                                [-2.533956169079926, 57.39330318031245],
                                [-2.537826419628114, 57.389599912060376],
                                [-2.541519300401861, 57.38584452052348],
                                [-2.5450324461742886, 57.38203946680276],
                                [-2.5483636116545987, 57.378187243771706],
                                [-2.551510672836659, 57.37429037441377],
                                [-2.554471628261437, 57.370351410142],
                                [-2.5572446001927687, 57.36637292910191],
                                [-2.5598278357060598, 57.36235753445855],
                                [-2.562219707689565, 57.358307852669505],
                                [-2.564418715757983, 57.35422653174438],
                                [-2.566423487078162, 57.35011623949252],
                                [-2.56556, 57.35],
                                [-1.96722, 57.35],
                                [-1.97639, 57.36472],
                            ],
                        ],
                    },
                },
            ],
        };

        const converter = new YaixmConverter({ fixGeometries: true, strictSchemaValidation: true });
        await converter.convertFromFile(inputFilepath, { type: 'airspace' });
        const geojson = converter.toGeojson();

        expect(geojson).toEqual(expectedGeojson);
    });
    it('read single airspace with single counter-clockwise arc definition', async () => {
        const inputFilepath = './tests/fixtures/airspace-single-arc-counterclockwise.yaml';
        const expectedGeojson = {
            type: 'FeatureCollection',
            features: [
                {
                    type: 'Feature',
                    properties: {
                        name: 'ABERDEEN CTA',
                        type: 'CTA',
                        class: 'D',
                        upperCeiling: {
                            value: 115,
                            unit: 'FL',
                            referenceDatum: 'STD',
                        },
                        lowerCeiling: {
                            value: 1500,
                            unit: 'FT',
                            referenceDatum: 'MSL',
                        },
                        activatedByNotam: false,
                        activity: 'NONE',
                    },
                    geometry: {
                        type: 'Polygon',
                        coordinates: [
                            [
                                [-2.479705113543898, 57.13582290212973],
                                [-2.4170034633262563, 57.03704915516119],
                                [-2.413674375741601, 57.032142176208055],
                                [-2.4100646804350774, 57.0272943995059],
                                [-2.406178028633525, 57.022510582238496],
                                [-2.4020183389419407, 57.01779541700718],
                                [-2.3975897931502383, 57.01315352730411],
                                [-2.3928968318047317, 57.00858946305923],
                                [-2.387944149549829, 57.00410769626451],
                                [-2.3827366902455682, 56.99971261667977],
                                [-2.3772796418667212, 56.99540852762347],
                                [-2.3715784311893238, 56.99119964185235],
                                [-2.365638718270563, 56.98709007753354],
                                [-2.3594663907280737, 56.98308385431241],
                                [-2.353067557824746, 56.9791848894798],
                                [-2.3464485443652587, 56.975396994241585],
                                [-2.339615884410587, 56.97172387009409],
                                [-2.3325763148168304, 56.96816910530808],
                                [-2.3253367686047253, 56.96473617152448],
                                [-2.3179043681662996, 56.96142842046461],
                                [-2.310286418315132, 56.95824908075763],
                                [-2.302490399186745, 56.955201254887825],
                                [-2.294523958995691, 56.95228791626426],
                                [-2.286394906655907, 56.9495119064152],
                                [-2.278111204270954, 56.94687593230945],
                                [-2.2696809595007923, 56.94438256380711],
                                [-2.2611124178117232, 56.94203423124132],
                                [-2.252413954616184, 56.939833223133334],
                                [-2.243594067309082, 56.93778168404268],
                                [-2.23466136720736, 56.93588161255382],
                                [-2.2256245713994938, 56.93413485940142],
                                [-2.216492494511651, 56.93254312573512],
                                [-2.207274040397208, 56.93110796152584],
                                [-2.197978193756368, 56.92983076411413],
                                [-2.188614011692587, 56.92871277690247],
                                [-2.1791906152125553, 56.927755088191844],
                                [-2.1697171806764386, 56.926958630163966],
                                [-2.160202931205138, 56.92632417800991],
                                [-2.1506571280512694, 56.92585234920543],
                                [-2.1410890619406175, 56.92554360293415],
                                [-2.131508044390774, 56.92539823965841],
                                [-2.1219233990137054, 56.925416400838735],
                                [-2.112344452808972, 56.925598068801634],
                                [-2.1027805274543274, 56.92594306675611],
                                [-2.0932409306004325, 56.926451058958826],
                                [-2.0837349471764117, 56.92712155102772],
                                [-2.0742718307129784, 56.927953890403856],
                                [-2.064860794689859, 56.92894726696129],
                                [-2.05551100391426, 56.9301007137642],
                                [-2.046231565937079, 56.931413107971004],
                                [-2.0370315225136233, 56.93288317188444],
                                [-2.027919841115539, 56.93450947414718],
                                [-2.0189054065006937, 56.93629043108153],
                                [-2.0099970123477373, 56.938224308172806],
                                [-2.001203352962063, 56.94030922169453],
                                [-1.9925330150598877, 56.942543140474726],
                                [-1.9839944696371832, 56.94492388780173],
                                [-1.9755960639301477, 56.947449143467736],
                                [-1.9673460134739422, 56.95011644594899],
                                [-1.9592523942663729, 56.952923194720476],
                                [-1.9513231350432065, 56.955866652703264],
                                [-1.9435660096717857, 56.9589439488429],
                                [-1.9359886296696012, 56.96215208081633],
                                [-1.9285984368544424, 56.965487917865374],
                                [-1.921402696132741, 56.9689482037545],
                                [-1.9144084884326853, 56.97252955985042],
                                [-1.9076227037886533, 56.97622848832077],
                                [-1.9010520345834772, 56.980041375449694],
                                [-1.8947029689550077, 56.98396449506711],
                                [-1.8885817843734096, 56.98799401208914],
                                [-1.8826945413955536, 56.99212598616635],
                                [-1.8770470776028225, 56.99635637543738],
                                [-1.8716450017285864, 57.000681040383924],
                                [-1.8664936879815182, 57.00509574778449],
                                [-1.8615982705708645, 57.00959617476315],
                                [-1.8569636384396688, 57.01417791292991],
                                [-1.8525944302118955, 57.01883647260912],
                                [-1.8484950293592528, 57.023567287152126],
                                [-1.8446695595934448, 57.02836571733045],
                                [-1.8411218804894351, 57.03322705580573],
                                [-1.8378555833452008, 57.03814653167193],
                                [-1.83487398728329, 57.04311931506652],
                                [-1.8321801355993872, 57.04814052184572],
                                [-1.8297767923628965, 57.05320521832003],
                                [-1.8276664392744157, 57.05830842604548],
                                [-1.8258512727847802, 57.06344512666622],
                                [-1.8243332014801799, 57.068610266804114],
                                [-1.8231138437376477, 57.07379876299034],
                                [-1.8221945256550158, 57.079005506635],
                                [-1.8215762792592125, 57.08422536902933],
                                [-1.8212598409965473, 57.08945320637632],
                                [-1.8212456505083903, 57.09468386484444],
                                [-1.8215338496954032, 57.099912185639965],
                                [-1.822124282073214, 57.105133010092665],
                                [-1.8230164924221546, 57.11034118475007],
                                [-1.824209726733413, 57.115531566475106],
                                [-1.8257029324536336, 57.12069902754217],
                                [-1.8274947590297261, 57.12583846072656],
                                [-1.8295835587553018, 57.130944784381796],
                                [-1.8319673879198617, 57.13601294750031],
                                [-1.8346440082615096, 57.14103793475162],
                                [-1.837610888723643, 57.1460147714934],
                                [-1.83861, 57.14583],
                                [-1.8999917721397073, 57.2436929728432],
                                [-1.8988083134757863, 57.24120082015165],
                                [-1.8966974211313257, 57.23609364814599],
                                [-1.894884606818966, 57.23095308123781],
                                [-1.8933715398804327, 57.22578420758956],
                                [-1.8921595910405336, 57.22059214123496],
                                [-1.891249831543777, 57.215382016988954],
                                [-1.890643032594567, 57.21015898534555],
                                [-1.8903396650995312, 57.20492820736865],
                                [-1.8903398997102232, 57.19969484958116],
                                [-1.8906436071641513, 57.19446407885729],
                                [-1.8912503589217693, 57.189241057323216],
                                [-1.892159428096801, 57.18403093727121],
                                [-1.8933697906769784, 57.17883885609173],
                                [-1.8948801270320224, 57.17366993122915],
                                [-1.8966888237054356, 57.16852925516526],
                                [-1.898793975486439, 57.16342189043574],
                                [-1.9011933877581502, 57.15835286468424],
                                [-1.9038845791178811, 57.15332716575868],
                                [-1.9068647842652253, 57.14834973685455],
                                [-1.9101309571534073, 57.14342547170922],
                                [-1.9136797743991725, 57.138559209852595],
                                [-1.917507638946325, 57.13375573191743],
                                [-1.9216106839778566, 57.12901975501443],
                                [-1.9259847770714347, 57.12435592817573],
                                [-1.9306255245928956, 57.11976882787132],
                                [-1.9355282763222368, 57.11526295360202],
                                [-1.9406881303064674, 57.11084272357312],
                                [-1.9460999379335788, 57.106512470452586],
                                [-1.9517583092217645, 57.10227643721723],
                                [-1.9576576183179335, 57.09813877309082],
                                [-1.963792009199454, 57.09410352957737],
                                [-1.970155401572995, 57.090174656593184],
                                [-1.976741496964233, 57.08635599870085],
                                [-1.9835437849921491, 57.082651291448485],
                                [-1.9905555498215453, 57.07906415781717],
                                [-1.9977698767873797, 57.07559810477977],
                                [-2.005179659184446, 57.07225651997379],
                                [-2.0127776052158954, 57.069042668491214],
                                [-2.020556245094043, 57.065959689787796],
                                [-2.028507938286866, 57.0630105947146],
                                [-2.0366248809035947, 57.06019826267382],
                                [-2.044899113212723, 57.05752543890176],
                                [-2.0533225272857885, 57.05499473188048],
                                [-2.0618868747602224, 57.0526086108809],
                                [-2.0705837747145663, 57.05036940363879],
                                [-2.0794047216493396, 57.04827929416578],
                                [-2.0883410935668127, 57.04634032069709],
                                [-2.097384160142959, 57.044554373777586],
                                [-2.106525090984833, 57.04292319448768],
                                [-2.1157549639666158, 57.04144837281045],
                                [-2.1250647736375763, 57.04013134614136],
                                [-2.134445439695183, 57.03897339794158],
                                [-2.143887815516609, 57.03797565653622],
                                [-2.153382696741861, 57.0371390940581],
                                [-2.162920829901768, 57.036464525538115],
                                [-2.172492921084069, 57.035952608142935],
                                [-2.1820896446308287, 57.035603840560206],
                                [-2.1917016518604258, 57.035418562532506],
                                [-2.201319579807335, 57.035396954539564],
                                [-2.210934059972958, 57.03553903762959],
                                [-2.2205357270807196, 57.03584467339961],
                                [-2.230115227828682, 57.03631356412487],
                                [-2.2396632296329004, 57.03694525303707],
                                [-2.249170429354766, 57.03773912475153],
                                [-2.2586275620055654, 57.038694405842676],
                                [-2.268025409421497, 57.0398101655674],
                                [-2.2773548089023694, 57.04108531673592],
                                [-2.2866066618072383, 57.04251861672942],
                                [-2.2957719421001883, 57.04410866866336],
                                [-2.304841704839519, 57.045853922696175],
                                [-2.313807094603563, 57.04775267748159],
                                [-2.3226593538463742, 57.04980308176408],
                                [-2.3313898311765233, 57.052003136115786],
                                [-2.3399899895522625, 57.054350694813714],
                                [-2.3484514143862834, 57.05684346785556],
                                [-2.356765821553349, 57.059479023112885],
                                [-2.3649250652940563, 57.062254788619555],
                                [-2.3729211460079975, 57.06516805499387],
                                [-2.3807462179296244, 57.068215977992246],
                                [-2.3883925966801116, 57.071395581192654],
                                [-2.395852766688546, 57.07470375880531],
                                [-2.4031193884757895, 57.07813727860866],
                                [-2.4101853057943856, 57.081692785007974],
                                [-2.417043552617922, 57.08536680221431],
                                [-2.4236873599732736, 57.08915573754098],
                                [-2.430110162609217, 57.0930558848149],
                                [-2.4363056054949292, 57.097063427900125],
                                [-2.442267550141949, 57.10117444433022],
                                [-2.44799008074323, 57.105384909046826],
                                [-2.453467510122971, 57.109690698241096],
                                [-2.458694385490991, 57.114087593294535],
                                [-2.463665493995485, 57.11857128481621],
                                [-2.468375868068075, 57.12313737677259],
                                [-2.472820790555178, 57.12778139070653],
                                [-2.476995799629789, 57.1324987700416],
                                [-2.479705113543898, 57.13582290212973],
                            ],
                        ],
                    },
                },
            ],
        };

        const converter = new YaixmConverter({ fixGeometries: true, strictSchemaValidation: true });
        await converter.convertFromFile(inputFilepath, { type: 'airspace' });
        const geojson = converter.toGeojson();

        expect(geojson).toEqual(expectedGeojson);
    });
    it('read single airspace with circle definition', async () => {
        const inputFilepath = './tests/fixtures/airspace-circle.yaml';
        const expectedGeojson = {
            type: 'FeatureCollection',
            features: [
                {
                    type: 'Feature',
                    properties: {
                        name: 'BARKSTON HEATH',
                        type: 'ATZ',
                        class: 'G',
                        upperCeiling: {
                            value: 2367,
                            unit: 'FT',
                            referenceDatum: 'MSL',
                        },
                        lowerCeiling: {
                            value: 0,
                            unit: 'FT',
                            referenceDatum: 'GND',
                        },
                        activatedByNotam: false,
                        activity: 'NONE',
                    },
                    geometry: {
                        type: 'Polygon',
                        coordinates: [
                            [
                                [-0.56028, 52.99637082627237],
                                [-0.5637551957176583, 52.9963050443243],
                                [-0.5672166447783494, 52.99610795869128],
                                [-0.5706506552774303, 52.99578034897044],
                                [-0.574043644590878, 52.99532351103976],
                                [-0.57738219345654, 52.99473925189719],
                                [-0.5806530993873413, 52.994029882464844],
                                [-0.5838434291984541, 52.993198208387916],
                                [-0.5869405704344262, 52.99224751886575],
                                [-0.5899322814871999, 52.99118157356074],
                                [-0.592806740201808, 52.99000458763854],
                                [-0.5955525907732857, 52.988721215000375],
                                [-0.5981589887459298, 52.98733652977598],
                                [-0.6006156439344364, 52.985856006152176],
                                [-0.6029128610956104, 52.98428549661921],
                                [-0.6050415781891975, 52.98263120872293],
                                [-0.6069934020769087, 52.98089968041703],
                                [-0.6087606415198139, 52.979097754114974],
                                [-0.6103363373459191, 52.97723254954624],
                                [-0.6117142896718587, 52.975311435526336],
                                [-0.612889082075154, 52.97334200075399],
                                [-0.6138561026263601, 52.97133202375269],
                                [-0.614611561703566, 52.969289442077],
                                [-0.6151525065250902, 52.96722232090645],
                                [-0.615476832349726, 52.96513882115257],
                                [-0.6155832903075139, 52.96304716720559],
                                [-0.6154714918376576, 52.96095561444891],
                                [-0.6151419097238288, 52.95887241667016],
                                [-0.6145958757306293, 52.95680579349722],
                                [-0.6138355748583882, 52.954763897987945],
                                [-0.6128640362466651, 52.95275478450063],
                                [-0.611685120769802, 52.95078637697172],
                                [-0.6103035053805418, 52.94886643772453],
                                [-0.6087246642700715, 52.947002536930945],
                                [-0.6069548469248296, 52.9452020228452],
                                [-0.6050010531719725, 52.94347199292531],
                                [-0.6028710053165203, 52.94181926595433],
                                [-0.6005731174838391, 52.940250355269214],
                                [-0.5981164622912594, 52.93877144320107],
                                [-0.5955107349822324, 52.93738835682493],
                                [-0.5927662151654816, 52.936106545112835],
                                [-0.5898937263100813, 52.93493105757773],
                                [-0.5869045931552797, 52.933866524490384],
                                [-0.5838105972011551, 52.93291713874489],
                                [-0.5806239304528518, 52.93208663944228],
                                [-0.5773571475971443, 52.931378297254966],
                                [-0.5740231167954679, 52.93079490162782],
                                [-0.570634969282248, 52.930338749864774],
                                [-0.5672060479614325, 52.93001163814249],
                                [-0.5637498551975082, 52.92981485448519],
                                [-0.56028, 52.929749173727636],
                                [-0.5568101448024919, 52.92981485448519],
                                [-0.5533539520385676, 52.93001163814249],
                                [-0.5499250307177521, 52.930338749864774],
                                [-0.5465368832045322, 52.93079490162782],
                                [-0.5432028524028557, 52.931378297254966],
                                [-0.5399360695471483, 52.93208663944228],
                                [-0.5367494027988449, 52.93291713874489],
                                [-0.5336554068447205, 52.933866524490384],
                                [-0.5306662736899187, 52.93493105757773],
                                [-0.5277937848345186, 52.936106545112835],
                                [-0.5250492650177677, 52.93738835682493],
                                [-0.5224435377087407, 52.93877144320107],
                                [-0.519986882516161, 52.940250355269214],
                                [-0.5176889946834797, 52.94181926595433],
                                [-0.5155589468280276, 52.94347199292531],
                                [-0.5136051530751704, 52.9452020228452],
                                [-0.5118353357299286, 52.947002536930945],
                                [-0.5102564946194583, 52.94886643772453],
                                [-0.5088748792301981, 52.95078637697172],
                                [-0.507695963753335, 52.95275478450063],
                                [-0.5067244251416119, 52.954763897987945],
                                [-0.5059641242693707, 52.95680579349722],
                                [-0.5054180902761712, 52.95887241667016],
                                [-0.5050885081623424, 52.96095561444891],
                                [-0.5049767096924862, 52.96304716720559],
                                [-0.5050831676502741, 52.96513882115257],
                                [-0.5054074934749099, 52.96722232090645],
                                [-0.505948438296434, 52.969289442077],
                                [-0.50670389737364, 52.97133202375269],
                                [-0.5076709179248461, 52.97334200075399],
                                [-0.5088457103281414, 52.975311435526336],
                                [-0.510223662654081, 52.97723254954624],
                                [-0.5117993584801862, 52.979097754114974],
                                [-0.5135665979230915, 52.98089968041703],
                                [-0.5155184218108027, 52.98263120872293],
                                [-0.5176471389043896, 52.98428549661921],
                                [-0.5199443560655637, 52.985856006152176],
                                [-0.5224010112540703, 52.98733652977598],
                                [-0.5250074092267144, 52.988721215000375],
                                [-0.5277532597981921, 52.99000458763854],
                                [-0.5306277185128002, 52.99118157356074],
                                [-0.533619429565574, 52.99224751886575],
                                [-0.536716570801546, 52.993198208387916],
                                [-0.5399069006126587, 52.994029882464844],
                                [-0.54317780654346, 52.99473925189719],
                                [-0.5465163554091221, 52.99532351103976],
                                [-0.5499093447225697, 52.99578034897044],
                                [-0.5533433552216507, 52.99610795869128],
                                [-0.5568048042823418, 52.9963050443243],
                                [-0.56028, 52.99637082627237],
                            ],
                        ],
                    },
                },
            ],
        };

        const converter = new YaixmConverter({ fixGeometries: true });
        await converter.convertFromFile(inputFilepath, { type: 'airspace' });
        const geojson = converter.toGeojson();

        expect(geojson).toEqual(expectedGeojson);
    });
    it('read single airspace with line definition', async () => {
        const inputFilepath = './tests/fixtures/airspace-single-line.yaml';
        const expectedGeojson = {
            type: 'FeatureCollection',
            features: [
                {
                    type: 'Feature',
                    properties: {
                        name: 'D138D SHOEBURYNESS',
                        type: 'DANGER',
                        class: 'UNCLASSIFIED',
                        upperCeiling: {
                            value: 13000,
                            unit: 'FT',
                            referenceDatum: 'MSL',
                        },
                        lowerCeiling: {
                            value: 0,
                            unit: 'FT',
                            referenceDatum: 'GND',
                        },
                        activatedByNotam: true,
                        activity: 'NONE',
                        remarks: 'NOTAM',
                    },
                    geometry: {
                        type: 'Polygon',
                        coordinates: [
                            [
                                [0.92667, 51.62056],
                                [0.83333, 51.62056],
                                [0.80111, 51.53806],
                                [0.85417, 51.5025],
                                [0.88333, 51.5],
                                [1.20083, 51.62056],
                                [0.92667, 51.62056],
                            ],
                        ],
                    },
                },
            ],
        };
        const converter = new YaixmConverter({ fixGeometries: false, strictSchemaValidation: true });
        await converter.convertFromFile(inputFilepath, { type: 'airspace' });
        const geojson = converter.toGeojson();

        expect(geojson).toEqual(expectedGeojson);
    });
    it('read single airspace with multiple sequence definition', async () => {
        const inputFilepath = './tests/fixtures/airspace-multi-sequence.yaml';
        const expectedGeojson = {
            type: 'FeatureCollection',
            features: [
                {
                    type: 'Feature',
                    properties: {
                        name: 'D138D SHOEBURYNESS',
                        type: 'DANGER',
                        class: 'UNCLASSIFIED',
                        upperCeiling: {
                            value: 13000,
                            unit: 'FT',
                            referenceDatum: 'MSL',
                        },
                        lowerCeiling: {
                            value: 0,
                            unit: 'FT',
                            referenceDatum: 'GND',
                        },
                        activatedByNotam: true,
                        activity: 'NONE',
                        remarks: 'NOTAM',
                    },
                    geometry: {
                        type: 'Polygon',
                        coordinates: [
                            [
                                [0.92667, 51.62056],
                                [0.83333, 51.62056],
                                [0.80111, 51.53806],
                                [0.85417, 51.5025],
                                [0.88333, 51.5],
                                [1.20083, 51.62056],
                                [0.92667, 51.62056],
                            ],
                        ],
                    },
                },
            ],
        };
        const converter = new YaixmConverter({ fixGeometries: false, strictSchemaValidation: true });
        await converter.convertFromFile(inputFilepath, { type: 'airspace' });
        const geojson = converter.toGeojson();

        expect(geojson).toEqual(expectedGeojson);
    });
});

describe('test parsing complete airspace file to GeoJSON file', () => {
    it('convert YAIXM airspace file to GeoJSON file without error', async () => {
        const inputFilepath = './tests/fixtures/airspace.yaml';
        const serviceFilePath = './tests/fixtures/service.yaml';
        const outputGeojsonFilepath = './var/airspace.geojson';

        const converter = new YaixmConverter({ fixGeometries: true, strictSchemaValidation: true });
        await converter.convertFromFile(inputFilepath, { type: 'airspace', serviceFilePath });
        await converter.toGeojsonFile(outputGeojsonFilepath);

        expect(true).toEqual(true);
    });
});
